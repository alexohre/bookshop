<div class="container-xxl flex-grow-1 container-p-y">
	<h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">Deposits /</span> Recent deposits</h4>
	<div class="row">
		<div class="card">
			<div class="col-md-3">
			</div>
			<div class="table-responsive text-nowrap">
				<table class="table table-striped mb-3">
					<thead>
						<tr>
							<th>Ref No</th>
							<th>Amount</th>
							<th>Payment Method</th>
							<th>Payment Proof</th>
							<th>Date</th>
							<th>Status</th>
							<th>Actions</th>
						</tr>
					</thead>
					<tbody class="table-border-bottom-0">
						<% if @deposits.present? %>
							<% @deposits.each do |deposit| %>
								<tr>
									<td><strong><%= deposit.order_id %></strong></td>
									<td><%= number_to_currency(deposit.amount, precision: 2) %></td>
									<td><%= deposit.payment_method.name %></td>
									<td><%= deposit.payment_proof.filename %> </td>
									<td><%= deposit.created_at.strftime("	%d-%m-%Y ") %> </td>
									<td>
										<% if deposit.status == "pending" %>
											<span class="badge bg-label-warning me-1"><%= deposit.status %></span>
										<% elsif deposit.status == "approved" %>
											<span class="badge bg-label-success me-1"><%= deposit.status %></span>
										<% elsif deposit.status == "declined" %>
											<span class="badge bg-label-danger me-1"><%= deposit.status %></span>
										<% end %>
									</td>
									<td>
										<button 
                    type="button" 
                    class="btn btn-sm btn-outline-secondary" 
                    data-bs-toggle="modal" 
                    data-bs-target="#modalScrollable"
                    data-deposit-order-id="<%= deposit.order_id %>"
                    data-deposit-date="<%= deposit.created_at.strftime('%d-%m-%Y ') %>"
                    data-deposit-amount="<%= number_to_currency(deposit.amount, precision: 2) %>"
                    data-deposit-payment_method="<%= deposit.payment_method.name %>"
                    data-deposit-status="<%= deposit.status %>"
                    data-deposit-proof="<%= url_for(deposit.payment_proof) %>"
                    >
											<span class="tf-icons bx bx-credit-card"></span>&nbsp; View deposit
										</button>
									</td>
								</tr>
							<% end %>
						<% else %>
							<tr >
								<td colspan="7" class="text-center">No deposit yet </td>
							</tr>
						<% end %>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<%# pagination %>
	<%= render 'account/shared/pagy', locals: {pagy: @pagy} %>
</div>
<%# modal %>
<div class="modal fade" id="modalScrollable" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="modalScrollableTitle">Deposit Details</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<h3>Ref No: <strong><span id="order_id"></span></strong></h3>
				<h3>Date: <strong><span id="date"></span></strong></h3>
				<h3>Amount: <strong><span id="amount"></span></strong></h3>
				<h3>Payment Method:<strong> <span id="payment_method"></span></strong></h3>
				<h3>Status: <strong><span id="status"></span></strong></h3>
				<p><strong>Proof: </strong><img src="" id="proof_image" class="img-fluid"></span></p>
		</div>
		<div class="modal-footer">
			<button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
				Close
			</button>
		</div>
	</div>
</div>
</div>
<script>
	document.addEventListener("DOMContentLoaded", function() {
	    const modalScrollable = document.getElementById("modalScrollable");
	    modalScrollable.addEventListener("show.bs.modal", function(event) {
	        const button = event.relatedTarget;
	        const orderId = button.getAttribute("data-deposit-order-id");
	        const date = button.getAttribute("data-deposit-date");
	        const amount = button.getAttribute("data-deposit-amount");
	        const paymentMethod = button.getAttribute("data-deposit-payment_method");
	        const status = button.getAttribute("data-deposit-status");
	        const proofUrl = button.getAttribute("data-deposit-proof");

	        const modalTitle = modalScrollable.querySelector(".modal-title");
	        const orderIdSpan = modalScrollable.querySelector("#order_id");
	        const dateSpan = modalScrollable.querySelector("#date");
	        const amountSpan = modalScrollable.querySelector("#amount");
	        const paymentMethodSpan = modalScrollable.querySelector("#payment_method");
	        const statusSpan = modalScrollable.querySelector("#status");
	        const proofImage = modalScrollable.querySelector("#proof_image");

	        modalTitle.textContent = "Deposit Details";
	        orderIdSpan.textContent = orderId;
	        dateSpan.textContent = date;
	        amountSpan.textContent = amount;
	        paymentMethodSpan.textContent = paymentMethod;
	        statusSpan.textContent = status;
	        proofImage.src = proofUrl;
	    });
	});
</script>
