
<% if current_user.admin? %>

<div class="container-xxl flex-grow-1 container-p-y">
  <div class="row">
    <div class="col-lg-8 mb-4 order-0">
      <div class="card">
        <div class="d-flex align-items-end row">
          <div class="col-sm-7">
            <div class="card-body">
              <% name = "#{current_user&.first_name}" %>
              <h1 class="card-title text-primary">Welcome Back <span class="fw-bold text-danger"><%= name.present? ? name : current_user.username %>!</span> ðŸŽ‰</h1>
              <p class="mb-4">
                Today is a brand new oppotunity to do more
              </p>
                <h4 class="pb-0 mb-0"><i class="menu-icon tf-icons bx bx-time"> <span id="clock" class="fw-bold"></span></i></h4>
            </div>
          </div>
          <div class="col-sm-5 text-center text-sm-left">
            <div class="card-body pb-0 px-0 px-md-4">
              <img
                src="../assets/img/illustrations/man-with-laptop-light.png"
                height="140"
                alt="View Badge User"
                data-app-dark-img="illustrations/man-with-laptop-dark.png"
                data-app-light-img="illustrations/man-with-laptop-light.png"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-4 order-1">
      <div class="row">
        <div class="col-lg-6 col-md-12 col-6 mb-4">
          <div class="card">
            <div class="card-body">
              <div class="card-title d-flex align-items-start justify-content-between">
                <div class="avatar flex-shrink-0">
                  <i class='bx bx-group rounded fs-1'></i>
                </div>
                
              </div>
              <span class="fw-semibold d-block mb-1">Students</span>
              <h3 class="card-title mb-2"><%= @total_students %></h3>
            </div>
          </div>
        </div>
        <div class="col-lg-6 col-md-12 col-6 mb-4">
          <div class="card">
            <div class="card-body">
              <div class="card-title d-flex align-items-start justify-content-between">
                <div class="avatar flex-shrink-0">
                  <i class='bx bx-group rounded fs-1'></i>
                </div>
                
              </div>
              <span>Staffs</span>
              <h3 class="card-title text-nowrap mb-1"><%= @total_staff %></h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Total Revenue -->
    <div class="col-12 col-lg-8 order-2 order-md-3 order-lg-2 mb-4">
      <div class="card">
        <div class="row row-bordered g-0">
          <div class="col">
            <h5 class="card-header m-0 me-2 pb-3">(5) Recent Orders</h5>
            <div class="table-responsive text-nowrap">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>S/N</th>
                    <th>Mat No</th>
                    <th>Total Books</th>
                    <th>Cashier</th>
                    <th>Amount</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody class="table-border-bottom-0">
                  <% if @recent_sales.present? %>
                    <% @recent_sales.includes(:student).each_with_index do |sale, index| %>
                      <tr>
                        <td><%= index + 1 %></td>
                        <td>
                          <%= sale.student.mat_no %>
                        </td>
                        <td>
                            <%= sale.sale_items_count %>
                        </td>
                        <td><%= sale.cashier_name %></td>
                        <td><span class="text-primary"><%= number_to_currency(sale.total_amount, precision: 2, unit: "â‚¦") %></span></td>
                        <td><%= link_to "View", admin_sale_path(sale), class: "btn btn-sm btn-primary" %></td>
                        
                      </tr>
                    <% end %>
                  <% else %>
                    <tr >
                      <td colspan="6" class="text-center fs-3 ">No Orders Yet </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
     
    </div>

    
    <!--/ Total Revenue -->
    <div class="col-12 col-md-8 col-lg-4 order-3 order-md-2">
      <div class="row">
        <div class="col-6 mb-4">
          <div class="card">
            <div class="card-body">
              <div class="card-title d-flex align-items-start justify-content-between">
                <div class="avatar flex-shrink-0">
                 <i class='bx bx-group rounded fs-1'></i>
                </div>
                
              </div>
              <span class="d-block mb-1">Lecturers</span>
              <h3 class="card-title text-nowrap mb-2"><%= @total_lecturer %></h3>
            </div>
          </div>
        </div>
        <div class="col-6 mb-4">
          <div class="card">
            <div class="card-body">
              <div class="card-title d-flex align-items-start justify-content-between">
                <div class="avatar flex-shrink-0">
                  <i class='bx bx-book rounded fs-1'></i>
                </div>
                
              </div>
              <span class="fw-semibold d-block mb-1">Stocks</span>
              <h3 class="card-title mb-2"><%= @total_stock %></h3>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </div>
 
</div>
<% else %>
  <div class="container-xxl flex-grow-1 container-p-y">
  <div class="row">
    <div class="col-lg-8 mb-4 order-0">
      <div class="card">
        <div class="d-flex align-items-end row">
          <div class="col-sm-7">
            <div class="card-body">
              <% name = "#{current_user&.first_name}" %>
              <h1 class="card-title text-primary">Welcome Back <span class="fw-bold text-danger"><%= name.present? ? name : current_user.username %>!</span> ðŸŽ‰</h1>
              <p class="mb-4">
                Today is a brand new oppotunity to do more
              </p>
                <h4 class="pb-0 mb-0"><i class="menu-icon tf-icons bx bx-time"> <span id="clock" class="fw-bold"></span></i></h4>
            </div>
          </div>
          <div class="col-sm-5 text-center text-sm-left">
            <div class="card-body pb-0 px-0 px-md-4">
              <img
                src="../assets/img/illustrations/man-with-laptop-light.png"
                height="140"
                alt="View Badge User"
                data-app-dark-img="illustrations/man-with-laptop-dark.png"
                data-app-light-img="illustrations/man-with-laptop-light.png"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-4 order-1">
      <div class="row">
        <div class="col-lg-6 col-md-12 col-6 mb-4">
          <div class="card">
            <div class="card-body">
              <div class="card-title d-flex align-items-start justify-content-between">
                <div class="avatar flex-shrink-0">
                  <i class='bx bx-group rounded fs-1'></i>
                </div>
                
              </div>
              <span class="fw-semibold d-block mb-1">Students</span>
              <h3 class="card-title mb-2"><%= @total_students %></h3>
            </div>
          </div>
        </div>
        <div class="col-lg-6 col-md-12 col-6 mb-4">
          <div class="card">
            <div class="card-body">
              <div class="card-title d-flex align-items-start justify-content-between">
                <div class="avatar flex-shrink-0">
                 <i class='bx bx-group rounded fs-1'></i>
                </div>
                
              </div>
              <span class="d-block mb-1">Lecturers</span>
              <h3 class="card-title text-nowrap mb-2"><%= @total_lecturer %></h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
 
</div>
<% end %>


<script>
  document.addEventListener("turbo:load", function() {
    function updateClock() {
      let now = new Date();
      let year = now.getFullYear().toString().slice(-2); // Extract last two digits of the year
      let month = (now.getMonth() + 1).toString().padStart(2, '0'); // Month is zero-based
      let day = now.getDate().toString().padStart(2, '0'); // Get the day of the month

      let hours = now.getHours();
      let minutes = now.getMinutes();
      let seconds = now.getSeconds();

      // Determine AM or PM
      let meridiem = hours < 12 ? 'AM' : 'PM';

      // Convert hours to 12-hour format
      hours = hours % 12;
      hours = hours ? hours : 12; // Handle midnight (0 hours)

      // Add leading zeros if necessary
      hours = hours < 10 ? '0' + hours : hours;
      minutes = minutes < 10 ? '0' + minutes : minutes;
      seconds = seconds < 10 ? '0' + seconds : seconds;

      // Update the clock display
      let clockElement = document.getElementById('clock');
      clockElement.textContent = day + '.' + month + '.' + year + ' ' + hours + ':' + minutes + ':' + seconds + ' ' + meridiem;
    }

    // Update the clock immediately and then every second
    updateClock();
    setInterval(updateClock, 1000);
  });
</script>